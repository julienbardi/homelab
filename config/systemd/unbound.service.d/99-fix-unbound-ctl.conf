[Service]
# Remove any stale socket before starting so Unbound can create a fresh one
ExecStartPre=/bin/sh -c '/bin/rm -f /run/unbound.ctl || true'

# Wait up to 5 seconds for the socket to appear, then set owner and perms.
ExecStartPost=/bin/sh -c 'for i in 0 1 2 3 4; do \
  if [ -e /run/unbound.ctl ]; then \
    /bin/chown root:unbound /run/unbound.ctl || true; \
    /bin/chmod 0660 /run/unbound.ctl || true; \
    exit 0; \
  fi; \
  sleep 1; \
done; exit 0'
