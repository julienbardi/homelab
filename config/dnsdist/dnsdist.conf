-- ------------------------------------------------------------
-- dnsdist: DNS over HTTPS backend (Caddy terminates TLS)
-- ------------------------------------------------------------

-- DNS over HTTPS listener (loopback only)
addDOHLocal(
  "127.0.0.1:8443",
  "/etc/dnsdist/certs/fullchain.pem",
  "/etc/dnsdist/certs/privkey.pem",
  { "/dns-query" }
)

addDOHLocal(
  "[::1]:8443",
  "/etc/dnsdist/certs/fullchain.pem",
  "/etc/dnsdist/certs/privkey.pem",
  { "/dns-query" }
)

-- Forward all DNS queries to Unbound
newServer({
  address = "127.0.0.1:5335",
  name = "unbound"
})

-- ACL is now effectively irrelevant, but harmless
setACL({
  "127.0.0.0/8",
  "::1/128"
})

-- Conservative safety defaults
setMaxUDPOutstanding(4096)
setMaxTCPClientThreads(100)
