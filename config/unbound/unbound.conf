# /etc/unbound/unbound.conf
# to deploy use:
# sudo install -m 0644 /home/julie/src/homelab/config/unbound/unbound.conf /etc/unbound/unbound.conf;sudo chown root:root /etc/unbound/unbound.conf
# sudo unbound-checkconf /etc/unbound/unbound.conf
# sudo systemctl enable unbound;sudo systemctl restart unbound;sudo systemctl status unbound;sudo journalctl -u unbound -f
# Older version
# sudo cp /home/julie/homelab/10.89.12.4/etc/unbound/unbound.conf /etc/unbound/;sudo chown root:root /etc/unbound/unbound.conf;sudo chmod 0644 /etc/unbound/unbound.conf;ls -l /etc/unbound/unbound.conf
# sudo systemctl enable unbound;sudo systemctl restart unbound;sudo systemctl status unbound;sudo journalctl -u unbound -f
server:
	username: "unbound"
	pidfile: ""

	local-data: "derp.vpn.bardi.ch. A 127.0.0.1" # splitâ€‘horizon override in the local resolver Unbound (for headscale DERP)

	module-config: "validator iterator"   # use "iterator" only if DNSSEC trust anchor fails

	do-not-query-localhost: no            # Allow queries to localhost

	auto-trust-anchor-file: "/var/lib/unbound/root.key"
	root-hints: "/var/lib/unbound/root.hints"

	interface: 127.0.0.1
	interface: ::1
	interface: 10.89.12.4
	interface: 2a01:8b81:4800:9c00::4

	access-control: 127.0.0.1/32 allow
	access-control: ::1/128 allow
	access-control: 127.0.0.0/8 allow
	access-control: 10.89.0.0/16 allow
	access-control: 2a01:8b81:4800:9c00::/64 allow
	access-control: 100.64.0.0/10 allow     # Tailscale
	access-control: 10.1.0.0/24 allow       # wg1
	access-control: 10.3.0.0/24 allow       # wg3
	access-control: 10.5.0.0/24 allow       # wg5
	access-control: 10.7.0.0/24 allow       # wg7
	access-control: fd10:4::/64 allow       # wg4 IPv6
	access-control: fd10:5::/64 allow       # wg5 IPv6
	access-control: fd10:6::/64 allow       # wg6 IPv6
	access-control: fd10:7::/64 allow       # wg7 IPv6

	do-ip6: yes

	num-threads: 5
	msg-cache-slabs: 8
	rrset-cache-slabs: 8
	infra-cache-slabs: 8
	key-cache-slabs: 8
	msg-cache-size: 256m
	rrset-cache-size: 512m
	key-cache-size: 128m
	neg-cache-size: 4m
	prefetch: yes
	prefetch-key: yes
	outgoing-range: 4096
	num-queries-per-thread: 8192
	serve-expired: yes
	so-reuseport: yes
	so-rcvbuf: 8m
	so-sndbuf: 8m

	hide-identity: yes
	hide-version: yes
	qname-minimisation: yes

	verbosity: 2

# Domain-specific forwarding: authoritative Infomaniak servers for bardi.ch
forward-zone:
	name: "bardi.ch"
	forward-addr: 84.16.67.66        # ns11.infomaniak.ch (IPv4)
	forward-addr: 2001:1600:4:11::11 # ns11.infomaniak.ch (IPv6)
	forward-addr: 84.16.66.66        # ns12.infomaniak.ch (IPv4)
	forward-addr: 2001:1600:4:12::12 # ns12.infomaniak.ch (IPv6)

# Default recursion fallback: global + local resolvers
# comment for full-recursion
forward-zone:
	name: "."
	# Cloudflare
	forward-addr: 1.1.1.1              # IPv4
	forward-addr: 1.0.0.1              # IPv4 secondary
	forward-addr: 2606:4700:4700::1111 # IPv6
	forward-addr: 2606:4700:4700::1001 # IPv6 secondary

	# Quad9
	forward-addr: 9.9.9.9              # IPv4
	forward-addr: 149.112.112.112      # IPv4 secondary
	forward-addr: 2620:fe::fe          # IPv6
	forward-addr: 2620:fe::9           # IPv6 secondary

	# Digitale Gesellschaft (Swiss privacy-focused resolver)
	forward-addr: 185.95.218.42        # IPv4
	forward-addr: 185.95.218.43        # IPv4 secondary
	# IPv6 currently not published by them, so only IPv4 here

remote-control:
	control-enable: yes
	control-interface: 127.0.0.1
	control-port: 8953
	server-key-file: /etc/unbound/unbound_server.key
	server-cert-file: /etc/unbound/unbound_server.pem
	control-key-file: /etc/unbound/unbound_control.key
	control-cert-file: /etc/unbound/unbound_control.pem
