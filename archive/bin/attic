#!/bin/sh
set -eu

# Attic client wrapper
# This binary is Nix-native and must be executed as an unprivileged user.

if [ "$(id -u)" -eq 0 ]; then
    echo "attic: refusing to run as root" >&2
    echo "attic: install runs as root, execution must not" >&2
    exit 1
fi

if command -v attic >/dev/null 2>&1; then
    # Prefer user profile if already on PATH
    exec attic "$@"
fi

if [ -x "$HOME/.nix-profile/bin/attic" ]; then
    exec "$HOME/.nix-profile/bin/attic" "$@"
fi

echo "attic: client not found" >&2
echo "attic: install with:" >&2
echo "attic:   nix profile install github:zhaofengli/attic" >&2
exit 127
